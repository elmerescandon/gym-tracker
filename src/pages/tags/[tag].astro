---
import BlogPost from "../../components/BlogPost.astro";
import BaseLayout from "../../layouts/BaseLayout.astro";

export async function getStaticPaths(): Promise<any> {
    const allPosts = await Astro.glob("../posts/*.md");

    return [
        {params: {tag: "astro"}, props: {posts: allPosts}},
        {params: {tag: "successes"}, props: {posts: allPosts}},
        {params: {tag: "community"}, props: {posts: allPosts}},
        {params: {tag: "blogging"}, props: {posts: allPosts}},
        {params: {tag: "setbacks"}, props: {posts: allPosts}},
        {params: {tag: "learning in public"}, props: {posts: allPosts}},
    ];
}

const {tag} = Astro.params;
const {posts} = Astro.props;
const filteredPosts = (posts as any[]).filter((post) =>
    post.frontmatter.tags?.includes(tag)
);
---

<BaseLayout pageTitle={tag}>
    <p>Posts tagged with {tag}</p>
    <ul>
        {
            filteredPosts.map((post) => (
                <li>
                    <BlogPost
                        url={post.url}
                        title={post.frontmatter.title}
                        author={post.frontmatter.author}
                        pubDate={
                            post.frontmatter.pubDate.toString().split("T")[0]
                        }
                        tags={post.frontmatter.tags}
                    />
                </li>
            ))
        }
    </ul>
</BaseLayout>

<style>
    h2 {
        color: #333;
    }
    ul {
        list-style: none;
        padding: 0;
    }
    li {
        margin-bottom: 1rem;
    }
</style>
